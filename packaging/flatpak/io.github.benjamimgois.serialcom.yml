app-id: io.github.benjamimgois.serialcom
runtime: org.kde.Platform
runtime-version: '6.10'
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '6.10'
command: serialcom

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=all

cleanup-commands:
  - /app/cleanup-BaseApp.sh

modules:
  - name: python3-pyte
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyte" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cf/81/82693467c9399c6bef9d1ce3e23c5a92ac6dcf496f67b4aea8e1be4acbf6/wcwidth-0.2.13-py2.py3-none-any.whl
        sha256: 3da69048e4540d84af32131829ff948f1e022c1c6bdb8d6102117aac784f6859
      - type: file
        url: https://files.pythonhosted.org/packages/d7/32/f2bcfa6eddc70a854ce9baa13db11ea39b96b1c8ab26eeae0c27c99d0ad8/pyte-0.8.2-py3-none-any.whl
        sha256: c0ca6a3e2c1d2f6b51e68ddd8d7f83098e3e05bf8f0cebcf51c20e04bfbc77e2

  - name: picocom
    buildsystem: simple
    build-commands:
      - make
      - install -Dm755 picocom ${FLATPAK_DEST}/bin/picocom
    sources:
      - type: archive
        url: https://github.com/npat-efault/picocom/archive/refs/tags/3.1.tar.gz
        sha256: e6761ca932ffc6d09bd6b11ff018bdaf70b287ce518b3282d29e0270e88420bb
        x-checker-data:
          type: anitya
          project-id: 11061
          url-template: https://github.com/npat-efault/picocom/archive/refs/tags/$version.tar.gz

  - name: serialcom
    buildsystem: simple
    build-commands:
      - install -Dm755 serialcom ${FLATPAK_DEST}/bin/serialcom
      - install -Dm644 assets/serialcom.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
      - install -Dm644 assets/icons/serialcom-256.png ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png
      - install -Dm644 assets/icons/serialcom-128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      - install -Dm644 assets/icons/serialcom-64.png ${FLATPAK_DEST}/share/icons/hicolor/64x64/apps/${FLATPAK_ID}.png
      - install -Dm644 assets/icons/serialcom-48.png ${FLATPAK_DEST}/share/icons/hicolor/48x48/apps/${FLATPAK_ID}.png
      - install -Dm644 assets/icons/serialcom-32.png ${FLATPAK_DEST}/share/icons/hicolor/32x32/apps/${FLATPAK_ID}.png
      - install -Dm644 assets/arrow_down.svg ${FLATPAK_DEST}/share/${FLATPAK_ID}/arrow_down.svg
      - install -Dm644 packaging/flatpak/${FLATPAK_ID}.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 packaging/flatpak/${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - install -Dm644 LICENSE ${FLATPAK_DEST}/share/licenses/${FLATPAK_ID}/LICENSE
    sources:
      - type: dir
        path: ../..
